<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
       
      <meta name="keywords" content="技术，编程，代码，教程，Java" />
       
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>1概述 |  wbl-z&#39;s Blog</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/images/logo.png" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 
<script>
var _hmt = _hmt || [];
(function() {
	var hm = document.createElement("script");
	hm.src = "https://hm.baidu.com/hm.js?edcb9d2dbc760f6eeab5900f9b363881";
	var s = document.getElementsByTagName("script")[0]; 
	s.parentNode.insertBefore(hm, s);
})();
</script>


      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-计算机网络自顶向下方法/1概述"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  1概述
</h1>
 

      
    <div class="article-author"  style="text-align: center ;font-size:20px" >
        作者： zzb
    </div>


    </header>
     
    <div class="article-meta">
      <a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B%E6%96%B9%E6%B3%95/1%E6%A6%82%E8%BF%B0/" class="article-date">
  <time datetime="2022-06-26T14:02:10.000Z" itemprop="datePublished">2022-06-26</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B%E6%96%B9%E6%B3%95/">计算机网络-自顶向下方法</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">4.9k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">17 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h1>1.概论</h1>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220309163725161.png" alt="image-20220309163725161"></p>
<h2 id="1-1-什么是Internet">1.1 什么是Internet</h2>
<p>互联网仅仅是网络的一种（是最为广泛的，有上亿的设备连接到互联网），还有其他的如银行的专用网络、军用的专用网络等</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220309165049534.png" alt="image-20220309165049534"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220309165745292.png" alt="image-20220309165745292"></p>
<p>计算机网络中</p>
<ul>
<li>节点：<strong>主机节点</strong>（可以是源、也可以是目标）（各种终端设备）、<strong>数据交换节点</strong>（既不是源，也不是目标）（如路由器【工作在网络层】、交换机【工作在数据链路层】）用<strong>方形</strong>表示主机节点，用<strong>圆形</strong>表示数据节点</li>
<li>边：<strong>接入（access）链路</strong>（方的和圆的连在一起）、<strong>主干（backbone）链路</strong>（圆的和圆的连接）</li>
<li>协议(protocol)</li>
</ul>
<p><strong>互联网</strong>就是多个网络通过网络互联设备连接起来的巨型的网络</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220309170227294.png" alt="image-20220309170227294"></p>
<p><strong><em>hosts</em> <em>=</em> <em>end systems</em></strong></p>
<p>通信链路的传输速率即带宽以bps作为单位</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220309171543056.png" alt="image-20220309171543056"></p>
<p>IETF(<em>因特网工程任务组(Internet Engineering Task Force, IETF )</em>)制定的RFC文档为<strong>请求评论</strong> <em>(Request For Comment, RFC)</em>，一个协议可能和多个RFC文档相关</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220309185346935.png" alt="image-20220309185346935"></p>
<p>协议(protocol)：<strong>对等层(Peer Layers)<strong>的实体，在通信过程中，应该遵守的规范和标准。规定了</strong>报文格式、次序、动作</strong></p>
<p><strong>PDU 协议数据单元</strong> 在每个层次上都有特指：应用层——message 传输层——segment 网络层——packet(如果是无连接方式的也称datagram) 数据链路层——frame</p>
<p>互联网中所有的通信行为都有协议的约束</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220309185614677.png" alt="image-20220309185614677"></p>
<p>从服务的角度：互联网是<strong>分布式的应用进程</strong>（网络存在的理由）和<strong>为应用进程提供通讯服务的基础设施</strong>（<strong>即源主机/目标主机应用层以下的所有应用实体</strong>）其中基础设施向应用进程提供服务的形式是API(<strong>套接字接口( socket interface：应用层在TCP/IP协议族中使用传输层服务的形式)</strong>)：面向连接的服务（TCP）、无连接的服务（UDP）</p>
<h2 id="1-2网络边缘">1.2网络边缘</h2>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220309190820574.png" alt="image-20220309190820574"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220309191056550.png" alt="image-20220309191056550"></p>
<p><em>network edge</em>、<em>network core</em>、<em>access networks</em></p>
<p>网络核心的作用就是<strong>数据交换(switch)</strong>，让任意两个网络边缘设施都能连接</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220309192041636.png" alt="image-20220309192041636"></p>
<ul>
<li><strong>CS客户端/服务器(client server)模式</strong>：主从模式——<strong>服务器是主</strong>，所有的资源都在服务器，<strong>客户端是从</strong>，所有的资源都来源于服务器<br>
<strong>可扩展性差</strong>，随着请求的增多，服务器能力下降，并且在达到一定的阈值后，服务器断崖式下落</li>
<li><strong>P2P</strong> **peer-peer模式：**一个分布式应用进程进程既是服务器，又是客户端，因此随着peer节点增多，请求的节点增多，提供的节点也在增多。因此使用在文件分发系统之中。<em>如迅雷，可以从迅雷上下载东西，即向多个其他主机上的迅雷请求资源的不同片段，因为是分布式的，同时当我们拥有了一些片段也可以向其他主机的迅雷客户端提供服务</em></li>
</ul>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220309193316313.png" alt="image-20220309193316313"></p>
<p>面向连接：连接状态的维持仅仅是<strong>端系统维护的。中间节点不维护连接</strong></p>
<blockquote>
<p>当中间路径上的节点都知道要维护被称为有连接，如下面的分组交换中的虚电路网络</p>
</blockquote>
<p><strong>可靠性</strong>：因此应用进程不需要考虑纠错等可靠性问题，当采用TCP时就已经假定可靠了</p>
<p><strong>流量控制</strong>是可以协调发送方的发送速度和接收方的接收速度，不会出现数据传输太快把数据淹没的情况</p>
<p><strong>拥塞控制</strong>：当中间链路拥堵时，如果发送方发的太快，那么到了中间某个节点，可能无法处理，中间节点会把这些数据丢弃。因此TCP还要考虑中间通路的通畅情况，<strong>堵塞时降低发送速度</strong></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220309194237963.png" alt="image-20220309194237963"></p>
<p><strong>无连接</strong>：无需建立连接状态，直接发送</p>
<h2 id="1-3网络核心">1.3网络核心</h2>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314200736805.png" alt="image-20220314200736805"></p>
<p><strong>circuit switch 电路交换</strong></p>
<p><strong>packet switch 分组交换</strong></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314201021637.png" alt="image-20220314201021637"></p>
<p><strong>建立</strong>一个<strong>独享的线路</strong>，<strong>保障了性能</strong>，利用独享的线路来进行通信，<strong>在之前需要建立链接</strong>。一般用于电话网</p>
<p>如果不用那么就会造成浪费，就像拨通了电话，但是不说话仍然需要收费</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314201622149.png" alt="image-20220314201622149"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314201719791.png" alt="image-20220314201719791"></p>
<p><strong>频分FDM</strong></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314202141900.png" alt="image-20220314202141900"></p>
<p><strong>时分TDM</strong>是指在将一个时钟周期划分成多个片，比如每个周期开始的第一个片分给第一个用户，第二个片分给第二个用户</p>
<p><strong>波分WDM</strong>采用光链路，即光纤的方式，将可用波段划分成多片</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314202522237.png" alt="image-20220314202522237"></p>
<p>0.5s建立连接，10s传输（<strong>传输时间</strong>），但传输完并不意味着对方已经接受到了，这里面存在着<strong>传播延迟</strong>（也即在线路上传播所需要的时间）。<strong>在局域网中，传播延迟可以忽略，但在广域网中，传播延迟是不能忽略的</strong></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314202723859.png" alt="image-20220314202723859"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314202905403.png" alt="image-20220314202905403"></p>
<ul>
<li><strong>优势：<strong>节点要把整个分组都存下来，然后再转发到下一个节点，<strong>存储转发机制</strong>保证了传输过程中一个时间点</strong>只会用到一个链路</strong>，只要这个链路接收到了全部才能用下一个链路转发，这样其他的链路就可以空闲出来用于其他的通信（<strong>共享</strong>）<em>（如果不存储，直接转发，那么和线路交换就是一样的了，只不过这里使用了全部的带宽）</em></li>
<li>没有建立连接的时间消耗</li>
<li><strong>代价：</strong><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314203920067.png" alt="image-20220314203920067"></li>
<li><strong>延迟会更大</strong></li>
<li><strong>可能需要排队</strong>，因为下一条线路可能被其他连接占用 了</li>
<li>如果路由器缓存用完了，那么分组会被<strong>抛弃</strong></li>
</ul>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314203619477.png" alt="image-20220314203619477"><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314203648517.png" alt="image-20220314203648517"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314204146968.png" alt="image-20220314204146968"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314204351989.png" alt="image-20220314204351989"></p>
<p><strong>链路上的复用</strong>（多个传输同时使用这条链路）没有固定模式，不像前面介绍的时分等，称为<strong>统计多路复用</strong></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314221204247.png" alt="image-20220314221204247"><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314221719766.png" alt="image-20220314221719766"></p>
<p>之所以是9而不算10是因为当线路上的流量满的，没有余量的时候，即流量强度=1的时候线路就会崩溃，此时的排队延迟为无穷大。</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314222334629.png" alt="image-20220314222334629"></p>
<p>分组交换网络（存储-转发）按照有无网络层的连接分成：</p>
<ul>
<li>
<p><strong>数据报网络</strong> <strong>datagram</strong>（<strong>无连接</strong>）</p>
<p><strong>每个</strong>源主机发向目标主机的<strong>分组</strong>，携带了目标主机<strong>完整的地址</strong>，因此两个主机在通讯之前<strong>不需要握手</strong>，在交换节点当中也不需要维护它们的通讯状态，只是<strong>将传入的分组根据路由表转走</strong>，至于到底是哪两个主机通讯并不关注，<strong>每个分组的传输都是独立的</strong>。<em>就像写信一样，每一封信都有完整的地址</em></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314223223616.png" alt="image-20220314223223616"></p>
<blockquote>
<p>通往同一个目标主机的分组可能走的是不同的路径，因为路由表可能在变，使得通过的路径不同</p>
</blockquote>
</li>
<li>
<p><strong>虚电路网络</strong>（有连接-不仅仅体现在源和目标，而且体现在中间的所有交换节点上）</p>
<p>需要靠<strong>信令</strong>建立一条<strong>虚拟的线路</strong>，在节点之间要维护通讯状态，<strong>每个分组携带了一个虚电路号</strong>，而不是完整地址。分组按照虚电路号来标识，存储-转发。<em>就像打电话</em></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314223757919.png" alt="image-20220314223757919"></p>
<p>每个交换节点都有虚电路表项</p>
</li>
</ul>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220314224006105.png" alt="image-20220314224006105"></p>
<h2 id="1-4-接入网与物理媒体">1.4 接入网与物理媒体</h2>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322173619078.png" alt="image-20220322173619078"></p>
<p>通过<strong>接入网</strong>将网路边缘接入网络核心</p>
<p>共享/独享</p>
<h3 id="住宅接入：拨号、DSL、电缆、FTTH和卫星">住宅接入：拨号、DSL、电缆、FTTH和卫星</h3>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322174505970.png" alt="image-20220322174505970"></p>
<p>90年代中后期</p>
<p><strong>modem 调制解调器</strong>即<strong>猫</strong>（Modulator&amp;Demodulator）</p>
<p><strong>利用已经有的电话线</strong>（而不是直接将光缆铺到每家每户-成本太大-如长城宽带），将上网数据**(数字信号)<strong>加载到音频信号</strong>(模拟信号)**上，利用电话线（能够保证4kHz）传输</p>
<p><strong>缺点</strong>：带宽窄，56Kbps左右，不能同时上网和打电话；以拨号上网速率上限56KBps为界，低于56KBps称为“窄带”，以上称为“宽带”</p>
<h4 id="DSL-数字用户线路">DSL 数字用户线路</h4>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322180306872.png" alt="image-20220322180306872"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322175857363.png" alt="image-20220322175857363"></p>
<p>DSL调制解调器 <strong>仍然是利用电话线调制解调</strong>，0~4kHz专用于音频，4kHz以上用于传输上网数据*（电话线可以保证4kHz，在4k以上还是可以挖掘的）*，同时<strong>4k以上</strong>划分为非对称的两个部分，<strong>一段用于上行，一段用于下行</strong>，<strong>用于下行的更大</strong>，<strong>即非对称</strong>【4~50kHz为上行，50kHZ~1MHz为下行】</p>
<p>因此本地电话公司是ISP，要求住宅离电话公司比较近，如果比较远，必须采用其他形式的接入网</p>
<p><strong>专用线路</strong></p>
<blockquote>
<p>非对称数字用户线路（ADSL，Asymmetric Digital Subscriber Line）是数字用户线路（xDSL，Digital Subscriber Line）服务中最流行的一种。</p>
<p>因为普通用户通常下载速度比上传速度更重要</p>
</blockquote>
<h4 id="线缆网络">线缆网络</h4>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322180340735.png" alt="image-20220322180340735"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322181255963.png" alt="image-20220322181255963"></p>
<p>电缆调制解调器</p>
<p>一部分用于传输原有的下行的数字电视广播，一部分用于互联网上行数据，一部分用于互联网下行数据</p>
<blockquote>
<p>上行是你的电脑发送数据到互联网上；下行是你从互联网上下载数据</p>
</blockquote>
<p>通过有线电视公司接入的互联网是<strong>共享的带宽</strong>（因为原来的广播电视也是共享广播媒体）</p>
<h4 id="FTTH-Fiber-To-The-Home光纤到户">FTTH Fiber To The Home光纤到户</h4>
<p>最简单的光纤分布网络称为直接光纤，从本地中心局到每户设置一根光纤。更为一般的是，从中心局岀来的每根光纤实际上由许多家庭共享，直到<strong>相对接近这些家庭的位置，该光纤才分成每户一根光纤</strong></p>
<p>两种光纤分布体系结构：<strong>主动光纤网络</strong>（Active Optical Network, AON)和<strong>被动光纤网络</strong>(Passive Optical Network, PON)</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407211813741.png" alt="image-20220407211813741"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322181614354.png" alt="image-20220322181614354"></p>
<h3 id="企业接入网络">企业接入网络</h3>
<p><strong>以太网</strong>：局域网技术</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407212538504.png" alt="image-20220407212538504"><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407212622045.png" alt="image-20220407212622045"><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407212703374.png" alt="image-20220407212703374"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322181723453.png" alt="image-20220322181723453"></p>
<p>通过交换机的级联，端系统直接连接到交换机上</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322181907009.png" alt="image-20220322181907009"></p>
<h3 id="物理媒体">物理媒体</h3>
<p>物理媒体即可以当作第0层</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322192657987.png" alt="image-20220322192657987"></p>
<p>无屏蔽双绞线(Unshielded Twisted Pair, UTP)常用在建筑物内的计算机网络中，即用于局域网(LAN)中</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322193022993.png" alt="image-20220322193022993"></p>
<p>有线电视的入户线一般是同轴电缆</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322193252969.png" alt="image-20220322193252969"></p>
<ul>
<li><strong>导引性媒体</strong>：信号在固体媒介中传播，传播得远</li>
<li><strong>非导引性媒体</strong>：如信号在开阔的地方传播，如无线电，传播的距离短</li>
</ul>
<h2 id="1-5-Internet结构和ISP">1.5 Internet结构和ISP</h2>
<p>ISP 网络服务提供商，如江苏移动，南京大学</p>
<p>另一种网络划分：<strong>按关系的远近来划分</strong>：将关系密切的在一个网络当中的设备称为ISP网络（其中包含很多的小的ISP），互联网是由很多的ISP网络构成的</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322194640657.png" alt="image-20220322194640657"></p>
<p>如果将每两个ISP两两连接代价会很大，是不可扩展的（即扩展到一定规模，性能迅速下降，代价非常大，这种特性就是不可扩展）</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322195255983.png" alt="image-20220322195255983"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322195352322.png" alt="image-20220322195352322"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322195615711.png" alt="image-20220322195615711"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322201306386.png" alt="image-20220322201306386"></p>
<p><strong>ICP 互联网内容提供商</strong>，如百度，谷歌。会构建自己的网络，建立自己的机房，因为接入他人的ISP成本高，且他人的ISP可能无法提供更好的服务。</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322200256295.png" alt="image-20220322200256295"></p>
<p>因此内容提供商的机房会建在<strong>离核心的ISP比较近的地方</strong>（<em>当然也会考虑到很多因素，如很多的数据中心机房是部署在贵州的，如苹果与云上贵州，原因是贵州地形复杂山多，地震少，机房不容易受到外界影响，有些部署在极地附近，考虑的是降温方便，成本低</em>），这样用户通过核心ISP很快就能访问到谷歌的机房，很快就能返回去。同时如果这个机房没有想要的内容，那么谷歌用<strong>自己的专用线路</strong>（有的可能是自己搭建的线缆，有的可能是租用已有的线缆）从其他机房获取数据返回来，再提供给用户。</p>
<h3 id="松散的层次结构">松散的层次结构</h3>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322200716939.png" alt="image-20220322200716939"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322200937618.png" alt="image-20220322200937618"></p>
<ul>
<li><strong>节点少</strong>（多了成本高）</li>
<li><strong>带宽大</strong>（覆盖国家/国际，速度慢无意义）</li>
<li>ISP之间通过peering link或者通过IXP连接</li>
</ul>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322201053710.png" alt="image-20220322201053710"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322201123499.png" alt="image-20220322201123499"></p>
<p>下层ISP是上层ISP的customer，需要通过上层ISP去连接网络的其他部分</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322201229556.png" alt="image-20220322201229556"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322201413107.png" alt="image-20220322201413107"></p>
<p><strong>通过接入多个高层ISP，可以提高服务质量</strong></p>
<h2 id="1-6-分组延时、丢失和吞吐量">1.6 分组延时、丢失和吞吐量</h2>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322202322104.png" alt="image-20220322202322104"></p>
<h3 id="延时-delay">延时 delay</h3>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322202413624.png" alt="image-20220322202413624"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322202537762.png" alt="image-20220322202537762"></p>
<ul>
<li><strong>节点处理延迟</strong></li>
<li><strong>排队延迟</strong>：注意是指不同分组之间排队，而不是分组内部的bit排队</li>
<li><strong>传输延迟</strong>：路由器将分组发送到链路上的时间，也即<strong>存储转发延迟</strong></li>
<li><strong>传播延迟</strong>：数据在链路上传播的时间</li>
</ul>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322203539894.png" alt="image-20220322203539894"></p>
<p><strong>广域网WAN的信道容量比局域网LAN要大</strong>：因为数据在广域网上链路长，传播延迟大，因此广域网的链路上同时可能正在传播多个数据报。而局域网链路短，传播延迟可以忽略不计，因此一个时间点链路上一般只有很少的数据报</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322203801790.png" alt="image-20220322203801790"></p>
<p><strong>Tracert 命令</strong>用 IP 生存时间 (TTL)(time to live) 字段和 ICMP 错误消息来确定从一个主机到网络上其他主机的路由。<strong>向每个路由器发出3个探测分组</strong></p>
<ul>
<li>首先，tracert送出一个TTL是1的IP 数据包到目的地</li>
<li>IP数据报每到一个路由器就把<strong>TTL-1</strong>，直到<strong>TTL=0</strong>时，路由器会把这个数据报丢弃并送回一个**「ICMP time exceeded」<em><em>消息</em>（包括发IP包的源地址，IP包的所有内容及路由器的IP地址）</em></li>
<li>接着tracert 再送出另一个TTL是2 的数据包……</li>
<li><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322210303328.png" alt="image-20220322210303328"></li>
<li>当数据包到达目的地后，该主机则不会送回ICMP time exceeded消息，一旦到达目的地，由于tracert通过UDP数据包向<strong>不常见端口(30000以上)</strong>（<em>即没有应用程序在监听这个端口，数据发过来只能被丢弃</em>）发送数据包，因此会收到**「ICMP port unreachable」**消息，故可判断到达目的地。</li>
</ul>
<blockquote>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322212900840.png" alt="image-20220322212900840"></p>
</blockquote>
<blockquote>
<p>如github的tracert，在中间延迟会突然增加，那么可能就是出现了trans-oceanic link跨洋的连接</p>
</blockquote>
<h3 id="丢失-loss">丢失 loss</h3>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322210739797.png" alt="image-20220322210739797"></p>
<ul>
<li>如果丢失节点和前一个节点之间的链路是可靠的，那么会由前一个节点重传。</li>
<li>如果中间的链路是不可靠的<em>如以太网，向上层提供的服务就是不可靠的</em>，且采用TCP，由源主机重传</li>
<li>如果中间的链路是不可靠的，且采用的是UDP，那么根本不重传</li>
</ul>
<h3 id="吞吐量-throughput">吞吐量 throughput</h3>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322211436294.png" alt="image-20220322211436294"></p>
<blockquote>
<p>容量capacity 有时指的是能容纳多少分组，即信道容量，有时指的是带宽，要看上下文</p>
</blockquote>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322211929165.png" alt="image-20220322211929165"></p>
<p><em>bottleneck</em> <em>link</em> <strong>瓶颈链路，即最小带宽的链路</strong></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220322212505648.png" alt="image-20220322212505648"></p>
<p>考虑最小带宽时还要考虑到多个传输都在使用的一个链路，如这里10个连接，那么R所在链路的带宽实际应为R/10</p>
<p><strong>但事实上R<sub>c</sub>、R<sub>s</sub>通常是瓶颈链路</strong></p>
<h2 id="1-7协议层次和服务模型">1.7协议层次和服务模型</h2>
<ul>
<li>使用模块化来将复杂的系统分解，模块与模块之间任意调用</li>
<li>使用分层的方式来将复杂系统分解，相邻两层进行调用，不允许或者不建议跨层调用</li>
</ul>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407093921810.png" alt="image-20220407093921810"></p>
<p>计算机网络采用分层方式：层次的内部更新换代对其他层次是透明的，问题分解，但效率会降低</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407085159872.png" alt="image-20220407085159872"></p>
<ul>
<li>
<p>对等层采用相同的协议，交换PDU</p>
</li>
<li>
<p>协议需要通过层间接口借助下层的服务实现（物理层不需要）</p>
<p><em>当然会包含所有更下层的服务，但增加了直接下层和对等实体交互的过程中形成的新特性（否则这一层没有意义）</em></p>
</li>
<li>
<p>协议的目的是为了向上层提供更好的服务（最上层不需要，因此应用是整个网络存在的利用）</p>
</li>
</ul>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407090946283.png" alt="image-20220407090946283"></p>
<p><strong>服务访问点SAP <em>service access point</em></strong> 即在层间接口有不同的访问点来<strong>区分</strong>多个上层用户——哪个报文是发给哪个上层用户的。SAP也即服务的<strong>地点</strong><br>
如<strong>套接字</strong>就是传输层和应用层的SAP：原理即从应用层往传输层往下传时进行标注，在对方往上传时加以区分</p>
<p><strong>原语 <em>primitive</em></strong>：服务的形式</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407091851148.png" alt="image-20220407091851148"></p>
<p>在通讯之前要有<strong>握手</strong>关系，为之后的通讯做好资源准备，这样的形式称为<strong>面向连接的服务</strong></p>
<p>适合大块数据的传输</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407092116211.png" alt="image-20220407092116211"></p>
<p>适合零星数据的传输</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407092357061.png" alt="image-20220407092357061"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407092653840.png" alt="image-20220407092653840"></p>
<p>SDU【<strong>真正要传输的信息</strong>】穿过层间接口需要加上控制信息ICI，一起构成IDU，之后即可将ICI丢弃，该层在SDU加上该层的头部信息n-header【<strong>一部分来自ICI，一部分是本层加的</strong>】【<em>可以理解为货车的头部</em>】，一起形成本层的n-PDU，然后n-PDU往下传输即作为n-1层的SDU，重复上面的过程</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407093226545.png" alt="image-20220407093226545"></p>
<p>有<strong>三种</strong>关系：直接在SDU上加header；SDU很大，需要拆分成多个小的，分别加上header；SDU很小且多个，可以合并在一起再加上header</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407094049374.png" alt="image-20220407094049374"></p>
<p>应用层的协议很多，有上千种传输层基本就两种TCP、UDP<br>
网络层的IP协议是做转发的，还有很多的路由选择协议链路层和物理层是配套封装在网卡中的</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407100737596.png" alt="image-20220407100737596"></p>
<p><strong>ISO</strong> <em>International Organization for Standardization</em></p>
<p><strong>OSI</strong> <em>Open System Interconnection Reference Model</em> 开放式系统互联通信参考模型</p>
<p>参考模型：模型分几层，每层什么功能，更抽象体系架构：每层有哪些协议，更具体</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407145511402.png" alt="image-20220407145511402"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407180211806.png" alt="image-20220407180211806"></p>
<h2 id="1-8历史">1.8历史</h2>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407194744786.png" alt="image-20220407194744786"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407194827782.png" alt="image-20220407194827782"></p>
<p>每个节点既是数据交换节点，也是端</p>
<p>IMP是路由器的雏形</p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407195211543.png" alt="image-20220407195211543"></p>
<p>网络互联原则：各种网络涌现，需要将不同的网络连接到一起，本质是创建一个网络的网络，即网络互联</p>
<p>cerf and kahn提出了TCP/IP，被誉为互联网之父</p>
<blockquote>
<p>1978年，温顿·瑟夫、罗伯特.卡恩、丹尼·科恩（Danny Cohen）和约翰·普斯特尔（Jon Postel）将TCP的功能分为两个协议：用来检测网络传输中差错的传输控制协议TCP，以及专门负责<strong>对不同网络进行互联</strong>的互联网协议IP。</p>
</blockquote>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407200922007.png" alt="image-20220407200922007"></p>
<blockquote>
<p>1983年1月1日，ARPANET正式将其网络核心协议由NCP替换为TCP/IP协议。所有主机停止，更换协议</p>
</blockquote>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407201255638.png" alt="image-20220407201255638"></p>
<blockquote>
<p>1984年，美国国家科学基金会（NSF）建立了NSFnet，作为超级计算机研究中心之间的连接。</p>
<p>最初，NSF曾试图使用ARPANET作为NSFnet的通信干线，但由于ARPANET的军方背景，以及受控于政府，这个决策没有成功。</p>
<p>于是他们决定自己出资，基于TCP/IP协议，建立完全属于自己的广域网。</p>
<p>NSFnet发展非常迅速，很快将全美各地的大学、政府和私人科研机构连接起来。NSFnet的速度也很快，比ARPANET网络快25倍以上。</p>
<p>渐渐地，NSFnet开始取代ARPANET，成为Internet的主干网。</p>
<p>80年代末，连接到NSFnet的计算机数量远远超过了ARPANET用户的数量。<strong>1990年6月1日，ARPANET被正式“拆除”。</strong></p>
<p>1991年8月6日，在瑞士日内瓦的核子研究中心（CERN）工作的英国物理学家<strong>蒂姆·伯纳斯·李</strong>（Tim Berners-Lee），正式提出了World Wide Web，也就是如今我们非常熟悉的www万维网。他还提出了HTTP（超文本传送协议）和HTML（超文本标记语言），设计了第一个网页浏览器，并建立了世界上第一个web网站。</p>
</blockquote>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407202442711.png" alt="image-20220407202442711"></p>
<h2 id="小结">小结</h2>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407202926611.png" alt="image-20220407202926611"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407202946339.png" alt="image-20220407202946339"></p>
<p><img src="https://screen-shot.obs.cn-north-4.myhuaweicloud.com/image-20220407203705644.png" alt="image-20220407203705644"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，均采用 CC BY-NC-SA 4.0 许可协议，转载请注明出处。
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://wbl-z.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B%E6%96%B9%E6%B3%95/1%E6%A6%82%E8%BF%B0/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B%E6%96%B9%E6%B3%95/0%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            0自顶向下
          
        </div>
      </a>
    
    
      <a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B%E6%96%B9%E6%B3%95/2%E5%BA%94%E7%94%A8%E5%B1%82/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">2应用层</div>
      </a>
    
  </nav>

  
   
  
   
    <script src="https://cdn.staticfile.org/twikoo/1.4.18/twikoo.all.min.js"></script>
    <div id="twikoo" class="twikoo"></div>
    <script>
        twikoo.init({
            envId: ""
        })
    </script>
 
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2022
        <i class="ri-heart-fill heart_icon"></i>  zzb
      </li>
    </ul>
    <ul>
      <li>
        R<i class="ri-heart-fill heart_icon"></i>Z
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        由 <a href="https://hexo.io" target="_blank">Hexo</a> 强力驱动
        <span class="division">|</span>
        主题 - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/logo.png" alt="wbl-z&#39;s Blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
    
      <li class="nav-item">
          <a href="https://github.com/wbl-z" target="_blank" class="my_link_li">
              <img src="/images/github.png">
          </a>
      </li>
      
      <li class="nav-item">
          <a href="https://blog.csdn.net/m0_51691879" target="_blank" class="my_link_li">
              <img src="/images/csdn.png">
          </a>
      </li>
      
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>